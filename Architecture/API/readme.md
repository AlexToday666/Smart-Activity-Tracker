# API слой

## Ответственность

API слой принимает HTTP-запросы, валидирует входные данные, конвертирует DTO <-> сущности и передаёт управление в сервисный слой.

## Основные классы

- `EventController` — CRUD и фильтрация событий (`/api/events`).
- `AnalyticsController` — аналитические эндпоинты (`/api/analytics`).

## Контракты

DTO в `src/main/java/com/example/ActivityTracker/dto`:

- `EventRequestDto` — входящий запрос (валидация `@NotBlank`).
- `EventResponseDto` — ответ для событий.
- `EventTypeCount` — элемент аналитики по типам событий.
- `DauResponseDto` — ответ DAU.

## Валидация и ошибки

- Валидация выполняется через `@Valid` и ограничения из DTO.
- В `GET /api/events` запрещено указывать `from` без `to` и наоборот — выбрасывается `BadRequestException`.
- В аналитике временной диапазон проверяется на уровне сервиса (см. `EventService`).

Ошибки сериализуются в `ApiError` через `GlobalExceptionHandler`.

## Пагинация и сортировка

`GET /api/events` принимает стандартные параметры `Pageable`:

- `page` — номер страницы (0-based)
- `size` — размер страницы
- `sort` — сортировка (например, `eventTime,desc`)

## Формат времени

Все временные параметры передаются как `Instant` в формате ISO‑8601 (UTC), например: `2026-01-21T12:00:00Z`.

## Расширение

Чтобы добавить новый эндпоинт:

1. Добавить метод в контроллере.
2. Реализовать логику в `EventService`.
3. При необходимости расширить `EventRepository`.
4. Обновить DTO/маппер и OpenAPI аннотации.
